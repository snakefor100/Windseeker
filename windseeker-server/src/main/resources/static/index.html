<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Azzinoth</title>
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/css/bootstrap-theme.css">
    <script type="text/javascript" src="/js/jquery-1.12.2.js"></script>
    <script type="text/javascript" src="/js/bootstrap.js"></script>
    <script type="text/javascript" src="/js/highchart/highcharts.js"></script>
    <script type="text/javascript" src="/js/highchart/themes/dark-unica.js"></script>

</head>
<body>
<div class="container-fluid">
    <div class="row-fluid">
        <div class="span12">
            <button onclick="startNet()">StartNet</button>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <div id="container" style="min-width:400px;height:400px;"></div>
        </div>
    </div>
</div>
<script type="text/javascript">
    //https://www.hcharts.cn/demo/highcharts/dynamic-update/dark-unica
    function startNet() {
        if ("WebSocket" in window)
        {
            alert("您的浏览器支持 WebSocket!");

            // 打开一个 web socket
            var ws = new WebSocket("ws://192.168.1.107:8156");
            ws.send("发送数据");
            ws.onopen = function()
            {
                // Web Socket 已连接上，使用 send() 方法发送数据
                ws.send("发送数据");
                alert("数据发送中...");
            };

            ws.onmessage = function (evt)
            {
                var received_msg = evt.data;
                alert("数据已接收...");
            };

            ws.onclose = function()
            {
                // 关闭 websocket
                alert("连接已关闭...");
            };
        }

        else
        {
            // 浏览器不支持 WebSocket
            alert("您的浏览器不支持 WebSocket!");
        }
    }
    $(function () {
        Highcharts.setOptions({
                                  global: {
                                      useUTC: false
                                  }
                              });
        function activeLastPointToolip(chart) {
            var points = chart.series[0].points;
            chart.tooltip.refresh(points[points.length - 1]);
        }

        $('#container').highcharts({
                                       chart: {
                                           type: 'spline',
                                           animation: Highcharts.svg, // don't animate in old IE
                                           marginRight: 10,
                                           events: {
                                               load: function () {
                                                   // set up the updating of the chart each second
                                                   var series = this.series[0],
                                                           chart = this;
                                                   setInterval(function () {

                                                       var nowTime = (new Date()).getTime();
                                                       var startTime = (new Date()).getTime() - 1000
//                            $.post("/azzinoth/queryMethodPerformance",)
                                                       var x = (new Date()).getTime(), // current time
                                                               y = Math.random();
                                                       series.addPoint([x, y], true, true);
                                                       activeLastPointToolip(chart)
                                                   }, 1000);
                                               }
                                           }
                                       },
                                       title: {
                                           text: '动态模拟实时数据'
                                       },
                                       xAxis: {
                                           type: 'datetime',
                                           tickPixelInterval: 150
                                       },
                                       yAxis: {
                                           title: {
                                               text: '值'
                                           },
                                           plotLines: [{
                                               value: 0,
                                               width: 1,
                                               color: '#808080'
                                           }]
                                       },
                                       tooltip: {
                                           formatter: function () {
                                               return '<b>' + this.series.name + '</b><br/>' +
                                                      Highcharts.dateFormat('%Y-%m-%d %H:%M:%S',
                                                                            this.x) + '<br/>' +
                                                      Highcharts.numberFormat(this.y, 2);
                                           }
                                       },
                                       legend: {
                                           enabled: false
                                       },
                                       exporting: {
                                           enabled: false
                                       },
                                       //初始化
                                       series: [{
                                           name: '随机数据',
                                           data: (function () {
                                               // generate an array of random data
                                               var data = [],
                                                       time = (new Date()).getTime(),
                                                       i;
                                               for (i = -19; i <= 0; i += 1) {
                                                   data.push({
                                                                 x: time + i * 1000,
                                                                 y: Math.random()
                                                             });
                                               }
                                               return data;
                                           }())
                                       }]
                                   }, function (c) {
            activeLastPointToolip(c)
        });

    });

</script>
</body>
</html>